#!/bin/bash
# screenshotter and recorder

PADDING=50

case "$1" in

    -s)

        maim -s -u -m 10 | xclip -sel clip -t image/png
        ;;

    -d)

        maim -s -u -m 10 "$HOME/usr/med/pic/scr/$(date +'%a_%I:%M').png"
        ;;

    -p)

        id=$(slw) &&
            wattr xywhb "$id" | {
                read -r x y w h b

                w=$((w + PADDING * 2))
                h=$((h + PADDING * 2))
                x=$((x - PADDING + b))
                y=$((y - PADDING + b))

                maim -m 10 -u -g "${w}x${h}+$x+$y" | xclip -selection clipboard -t image/png
            }
        ;;

    -c)

        maim -m 10 -u "$HOME/$(date +'%a_%I:%M').png"
        ;;

    -v)

        if pidof ffmpeg
        then
            killall ffmpeg
	          paplay "/usr/share/sounds/freedesktop/stereo/complete.oga" |: &
        else
            slop=$(slop -f "%x %y %w %h")

            read -r X Y W H < <(echo "$slop")

            width=${#W}

            if [ "$width" -gt 0 ];
            then
	          paplay "/usr/share/sounds/freedesktop/stereo/complete.oga" |: &

            ffmpeg -f x11grab\
                -s "$W"x"$H"\
                -framerate 60 \
                -thread_queue_size 512 \
                -i "$DISPLAY".0+"$X","$Y"\
                -vcodec libx264\
                -qp 18\
                -preset ultrafast \
            "$HOME/usr/med/vid/$(date +'%a_%I:%M').mp4"
            fi
        fi
        ;;

    -t)

        if pidof ffmpeg
        then
            killall ffmpeg
	          paplay "/usr/share/sounds/freedesktop/stereo/complete.oga" |: &
        else

        paplay "/usr/share/sounds/freedesktop/stereo/complete.oga" |: &
        ffmpeg \
            -video_size 1366x768 \
            -framerate 60 \
            -f x11grab \
            -i :0.0 \
            -c:v libx264 \
            -crf 0 \
            -preset ultrafast \
            -y \
            "$HOME/usr/med/vid/$(date +'%a_%I:%M').mp4"
        fi
        ;;

esac
