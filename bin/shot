#!/bin/bash
#screenshotter and recorder

#amount of padding in px (-p)
PADDING="70"

#flags
case "$1" in

    -s)
        #take screenshot by selection and save to clipboard
        maim -s -u -m 10 | xclip -sel clip -t image/png
        ;;

    -d)
        #takey screenshot by selection and save to dir
        maim -s -u -m 10 "$HOME/med/pic/scr/"$(date +'%a_%I:%M')".png"
        ;;

    -p)
        #take selection but add padding (defined at top)
        id="$(slw)" &&
          wattr xywhb "$id" | {
            read -r x y w h b

            w="$((w + PADDING * 2))" #width
            h="$((h + PADDING * 2))" #height
            x="$((x - PADDING + b))" #x value
            y="$((y - PADDING + b))" #y value

            #copy to clipboard
            maim -m 10 -u -g "${w}x${h}+$x+$y" | xclip -selection clipboard -t image/png
            }
        ;;

    -h)
        #take whole desktop screenshot
        maim -m 10 -u "$HOME/$(date +'%a_%I:%M').png"
        ;;

    -v)
          slop="$(slop -f "%x %y %w %h")" #select region to record

          read -r X Y W H < <(echo "$slop") #not POSIX

          width="${#W}" #make width var

          if [ "$width" -gt 0 ];
          then
          paplay "/usr/share/sounds/freedesktop/stereo/complete.oga" |: &

          #super duper ffmpeg command
          ffmpeg -f x11grab\
              -s "$W"x"$H"\
              -framerate 60 \
              -thread_queue_size 512 \
              -i "$DISPLAY".0+"$X","$Y"\
              -vcodec libx264\
              -qp 18\
              -preset ultrafast \
          "$HOME/med/vid/$(date +'%a_%I:%M').mp4" #change to match your dirs
          fi
        ;;

    -t)
        if pidof "ffmpeg" #toggle ffmpeg
        then
            pkill -9 ffmpeg && \
	          paplay "/usr/share/sounds/freedesktop/stereo/complete.oga" |: & #recording sound
        else

        paplay "/usr/share/sounds/freedesktop/stereo/complete.oga" |: &
        ffmpeg \
            -video_size "1366x768" \
            -framerate 60 \
            -f x11grab \
            -i :0.0 \
            -c:v libx264 \
            -crf 0 \
            -preset ultrafast \
            -y \
            "$HOME/med/vid/"$(date +'%a_%I:%M')".mp4" #change this to match your dirs
        fi
        ;;

    -c)
        #take a 800x600 screenshot of center of screen
        maim -g 800x600+283+84 -d 3 "$HOME/what.png"
        ;;

    -g)
        #start recording whole screen after 3 seconds
        #https://github.com/phisch/giph
        giph -d 3 "$HOME/what.gif"
        ;;
esac
